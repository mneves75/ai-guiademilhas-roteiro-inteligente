---
phase: 01-foundation-code-quality
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [.github/workflows/lint.yml, .github/workflows/type-check.yml, .github/workflows/test.yml]
autonomous: true

must_haves:
  truths:
    - "Every PR automatically runs linting and blocks merge if ESLint violations found"
    - "Every PR automatically runs type checking and blocks merge if TypeScript errors found"
    - "Every PR automatically runs tests and blocks merge if tests fail"
    - "GitHub Actions report results in PR checks UI (developer sees pass/fail immediately)"
    - "CI/CD works without manual setup (runs on every push to any branch, every PR)"
  artifacts:
    - path: ".github/workflows/lint.yml"
      provides: "GitHub Actions workflow for ESLint linting"
      contains: ["eslint", "max-warnings=0"]
    - path: ".github/workflows/type-check.yml"
      provides: "GitHub Actions workflow for TypeScript type checking"
      contains: ["tsc --noEmit", "typescript"]
    - path: ".github/workflows/test.yml"
      provides: "GitHub Actions workflow for running tests"
      contains: ["pnpm test", "vitest"]
  key_links:
    - from: ".github/workflows/lint.yml"
      to: "package.json"
      via: "workflow runs `pnpm lint` script"
      pattern: "run:.*pnpm lint"
    - from: ".github/workflows/type-check.yml"
      to: "tsconfig.json"
      via: "workflow runs `pnpm type-check` which uses tsconfig"
      pattern: "pnpm type-check"
    - from: ".github/workflows/*.yml"
      to: "pnpm"
      via: "pnpm/action-setup@v2 installs dependencies"
      pattern: "pnpm/action-setup"
---

<objective>
Create GitHub Actions CI/CD workflows that automatically run linting, type-checking, and tests on every PR and push. Prevent merged code from violating TypeScript strict mode, ESLint rules, or failing tests.

Purpose: Automated CI/CD catches errors before they reach production. Developers can't accidentally merge broken code.

Output: Three workflow files that trigger on PR/push and report results in GitHub UI.
</objective>

<execution_context>
@/Users/mneves/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mneves/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-code-quality/01-RESEARCH.md

Reference: GitHub Actions docs, pnpm/action-setup documentation, Node.js setup action
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ESLint GitHub Actions workflow</name>
  <files>.github/workflows/lint.yml</files>
  <action>
    Create .github/workflows/lint.yml with:

    ```yaml
    name: Linting

    on:
      push:
        branches: [main, develop]
      pull_request:
        branches: [main, develop]

    jobs:
      lint:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4

          - name: Setup Node.js
            uses: actions/setup-node@v4
            with:
              node-version: 20

          - name: Setup pnpm
            uses: pnpm/action-setup@v2
            with:
              version: 9

          - name: Get pnpm store directory
            shell: bash
            run: |
              echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV

          - name: Setup pnpm cache
            uses: actions/cache@v4
            with:
              path: ${{ env.STORE_PATH }}
              key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
              restore-keys: |
                ${{ runner.os }}-pnpm-store-

          - name: Install dependencies
            run: pnpm install --frozen-lockfile

          - name: Lint
            run: pnpm lint
    ```

    Key points:
    - Triggers on push to main/develop and all PRs
    - Uses Node.js 20 LTS (latest stable for Next.js 15)
    - Uses pnpm/action-setup to install pnpm v9
    - Caches pnpm store for faster subsequent runs
    - Runs `pnpm lint` which calls `eslint . --max-warnings=0`
    - Job fails if linting fails (no warnings allowed)
  </action>
  <verify>
    Check: .github/workflows/lint.yml exists and is valid YAML
    Check: File contains pnpm/action-setup@v2
    Check: File contains "pnpm lint" step
    Check: File contains "branches: [main, develop]"
  </verify>
  <done>
    Lint workflow committed. Will run on every PR and block merge if ESLint violations found.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TypeScript type-check GitHub Actions workflow</name>
  <files>.github/workflows/type-check.yml</files>
  <action>
    Create .github/workflows/type-check.yml with:

    ```yaml
    name: Type Check

    on:
      push:
        branches: [main, develop]
      pull_request:
        branches: [main, develop]

    jobs:
      type-check:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4

          - name: Setup Node.js
            uses: actions/setup-node@v4
            with:
              node-version: 20

          - name: Setup pnpm
            uses: pnpm/action-setup@v2
            with:
              version: 9

          - name: Get pnpm store directory
            shell: bash
            run: |
              echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV

          - name: Setup pnpm cache
            uses: actions/cache@v4
            with:
              path: ${{ env.STORE_PATH }}
              key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
              restore-keys: |
                ${{ runner.os }}-pnpm-store-

          - name: Install dependencies
            run: pnpm install --frozen-lockfile

          - name: Type check
            run: pnpm type-check
    ```

    Key points:
    - Separate from lint workflow (focuses only on TypeScript)
    - Uses same Node.js 20 and pnpm setup
    - Runs `pnpm type-check` which calls `tsc --noEmit`
    - Job fails if TypeScript errors found (strict mode catches errors)
  </action>
  <verify>
    Check: .github/workflows/type-check.yml exists and is valid YAML
    Check: File contains pnpm/action-setup@v2
    Check: File contains "pnpm type-check" step
    Check: File contains "branches: [main, develop]"
  </verify>
  <done>
    Type-check workflow committed. Will run on every PR and block merge if TypeScript errors found.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create test GitHub Actions workflow</name>
  <files>.github/workflows/test.yml</files>
  <action>
    Create .github/workflows/test.yml with:

    ```yaml
    name: Tests

    on:
      push:
        branches: [main, develop]
      pull_request:
        branches: [main, develop]

    jobs:
      test:
        runs-on: ubuntu-latest
        services:
          postgres:
            image: postgres:16-alpine
            env:
              POSTGRES_USER: postgres
              POSTGRES_PASSWORD: postgres
              POSTGRES_DB: nextjs_test
            options: >-
              --health-cmd pg_isready
              --health-interval 10s
              --health-timeout 5s
              --health-retries 5
            ports:
              - 5432:5432

        steps:
          - uses: actions/checkout@v4

          - name: Setup Node.js
            uses: actions/setup-node@v4
            with:
              node-version: 20

          - name: Setup pnpm
            uses: pnpm/action-setup@v2
            with:
              version: 9

          - name: Get pnpm store directory
            shell: bash
            run: |
              echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV

          - name: Setup pnpm cache
            uses: actions/cache@v4
            with:
              path: ${{ env.STORE_PATH }}
              key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
              restore-keys: |
                ${{ runner.os }}-pnpm-store-

          - name: Install dependencies
            run: pnpm install --frozen-lockfile

          - name: Setup test environment
            env:
              DATABASE_URL: postgresql://postgres:postgres@localhost:5432/nextjs_test
            run: |
              echo "DATABASE_URL=$DATABASE_URL" >> $GITHUB_ENV

          - name: Run tests
            run: pnpm test
            env:
              DATABASE_URL: postgresql://postgres:postgres@localhost:5432/nextjs_test
    ```

    Key points:
    - Includes PostgreSQL service (needed for Phase 2+ database tests)
    - Sets up test database with credentials and health check
    - Runs `pnpm test` which will call vitest (or jest if configured in Phase 12)
    - Exports DATABASE_URL for test environment
    - Job fails if any test fails
    - Can run in parallel with lint and type-check
  </action>
  <verify>
    Check: .github/workflows/test.yml exists and is valid YAML
    Check: File contains pnpm/action-setup@v2
    Check: File contains postgres service configuration
    Check: File contains "pnpm test" step
    Check: File contains DATABASE_URL environment variable setup
  </verify>
  <done>
    Test workflow committed. Will run on every PR and block merge if tests fail. PostgreSQL service provides database for Phase 2+ tests.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. Check GitHub repo settings: Verify branch protection rules are in place (if using main branch)
   - Require status checks to pass: lint, type-check, test
   - Dismiss stale reviews when new commits pushed
   - Require branches to be up to date before merging

2. Push a test commit to a PR branch:
   - All three workflows should trigger
   - Lint should report: "no TypeScript errors" (if no config issues)
   - Type-check should pass (no actual code yet)
   - Test should pass (or skip if no test files exist yet)

3. Verify GitHub PR UI shows all three checks:
   - All green checkmarks or "skipped" (acceptable for empty test suite)
   - Merge button only appears after all checks pass

Success: CI/CD is active. Any code that violates ESLint, TypeScript, or tests won't be merged.
</verification>

<success_criteria>
1. Three workflows exist and are valid YAML: .github/workflows/{lint,type-check,test}.yml
2. Each workflow triggers on push to main/develop and all PRs
3. Each workflow uses pnpm/action-setup@v2 and Node.js 20
4. Lint workflow runs `pnpm lint` and blocks on violations
5. Type-check workflow runs `pnpm type-check` and blocks on TypeScript errors
6. Test workflow runs `pnpm test` with PostgreSQL service running
7. All workflows use pnpm cache for faster subsequent runs
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-code-quality/01-02-SUMMARY.md` with:
- Frontmatter: status=complete, artifacts_created=[.github/workflows/*.yml], ci_enabled=true
- Summary of workflows configured
- Note that Vercel preview deployments handled separately in Plan 03
- Ready for Plan 03
</output>
